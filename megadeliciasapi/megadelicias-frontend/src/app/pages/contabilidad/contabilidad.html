<div class="p-6 min-h-screen bg-gray-100 font-sans">

  <!-- TÍTULO -->
  <header class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      Módulo de Contabilidad
    </h1>
    <p class="text-sm text-gray-500">
      Cierre de caja, balance general y resumen de ingresos vs gastos.
    </p>
  </header>

  <!-- MENSAJES GENERALES -->
  <div *ngIf="error" class="mb-4 px-4 py-3 rounded-md bg-red-50 text-red-700 border border-red-200 text-sm">
    {{ error }}
  </div>

  <div *ngIf="mensajeOk" class="mb-4 px-4 py-3 rounded-md bg-green-50 text-green-700 border border-green-200 text-sm">
    {{ mensajeOk }}
  </div>

  <!-- GRID PRINCIPAL -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- 1. CIERRE DIARIO (HOY) -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 flex flex-col gap-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-gray-800">
            Cierre diario (hoy)
          </h2>
          <p class="text-xs text-gray-500">
            Resumen de ventas del día de hoy calculado en tiempo real.
          </p>
        </div>

        <button
          class="px-3 py-1.5 rounded-md bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium"
          (click)="cargarCierreHoy()"
          [disabled]="cargandoCierreHoy">
          Actualizar
        </button>
      </div>

      <div *ngIf="cargandoCierreHoy" class="text-xs text-gray-500">
        Cargando cierre diario...
      </div>

      <ng-container *ngIf="!cargandoCierreHoy">
        <div *ngIf="cierreHoy; else sinCierreHoy" class="text-sm space-y-2">

          <!-- Fila Fecha / Estado -->
          <div class="flex justify-between items-center border-b border-gray-100 pb-2 mb-2">
            <p>
              <span class="font-semibold text-gray-600">Fecha:</span>
              <span class="ml-1">{{ cierreHoy.fecha }}</span>
            </p>
            <p>
              <span class="font-semibold text-gray-600 mr-2">Estado:</span>
              <span
                class="px-2 py-0.5 rounded-full text-xs font-semibold"
                [ngClass]="cierreHoy.cuadro ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                {{ cierreHoy.cuadro ? 'Sí cuadró' : 'No cuadró' }}
              </span>
            </p>
          </div>

          <p><span class="font-semibold text-gray-600">Caja inicial:</span>
            <span class="ml-1">L. {{ cierreHoy.cajaInicial | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Ventas en efectivo:</span>
            <span class="ml-1">L. {{ cierreHoy.totalEfectivo | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Ventas en tarjeta:</span>
            <span class="ml-1">L. {{ cierreHoy.totalTarjeta | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Ventas en transferencia:</span>
            <span class="ml-1">L. {{ cierreHoy.totalTransferencia | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Efectivo esperado:</span>
            <span class="ml-1">L. {{ cierreHoy.efectivoEsperado | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Efectivo contado:</span>
            <span class="ml-1">L. {{ cierreHoy.efectivoContado | number:'1.2-2' }}</span></p>
          <p><span class="font-semibold text-gray-600">Diferencia:</span>
            <span class="ml-1">L. {{ cierreHoy.diferencia | number:'1.2-2' }}</span></p>
        </div>

        <ng-template #sinCierreHoy>
          <div class="text-xs text-gray-400">
            No hay datos de cierre para hoy.
          </div>
        </ng-template>
      </ng-container>
    </section>

    <!-- 2. CIERRE POR FECHA -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 flex flex-col gap-4">
      <h2 class="text-lg font-semibold text-gray-800">
        Cierre por fecha
      </h2>
      <p class="text-xs text-gray-500">
        Busca el resumen de un día específico.
      </p>

      <form (ngSubmit)="buscarCierrePorFecha()" class="flex flex-col gap-3 text-sm">
        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Fecha</span>
          <input
            type="date"
            name="fechaBusqueda"
            [(ngModel)]="fechaBusqueda"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <button
          type="submit"
          class="self-start px-3 py-1.5 rounded-md bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium"
          [disabled]="cargandoBusqueda">
          Buscar cierre
        </button>
      </form>

      <div *ngIf="cargandoBusqueda" class="text-xs text-gray-500">
        Buscando cierre...
      </div>

      <div *ngIf="cierreBuscado" class="text-sm space-y-2">
        <p><strong>Fecha:</strong> {{ cierreBuscado.fecha }}</p>
        <p><strong>Caja inicial:</strong> L. {{ cierreBuscado.cajaInicial | number:'1.2-2' }}</p>
        <p><strong>Ventas en efectivo:</strong> L. {{ cierreBuscado.totalEfectivo | number:'1.2-2' }}</p>
        <p><strong>Ventas en tarjeta:</strong> L. {{ cierreBuscado.totalTarjeta | number:'1.2-2' }}</p>
        <p><strong>Ventas en transferencia:</strong> L. {{ cierreBuscado.totalTransferencia | number:'1.2-2' }}</p>
        <p><strong>Efectivo esperado:</strong> L. {{ cierreBuscado.efectivoEsperado | number:'1.2-2' }}</p>
        <p><strong>Efectivo contado:</strong> L. {{ cierreBuscado.efectivoContado | number:'1.2-2' }}</p>
        <p><strong>Diferencia:</strong> L. {{ cierreBuscado.diferencia | number:'1.2-2' }}</p>
        <p>
          <strong>Estado:</strong>
          <span
            [ngClass]="cierreBuscado.cuadro ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'">
            {{ cierreBuscado.cuadro ? 'Sí cuadró' : 'No cuadró' }}
          </span>
        </p>
      </div>
    </section>

    <!-- 3. CREAR CIERRE -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 flex flex-col gap-4">
      <h2 class="text-lg font-semibold text-gray-800">
        Crear cierre de caja
      </h2>
      <p class="text-xs text-gray-500">
        Registra el cierre de un día: caja inicial, efectivo contado y observaciones.
      </p>

      <form (ngSubmit)="crearCierre()" class="grid grid-cols-1 gap-3 text-sm">
        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Fecha del cierre</span>
          <input
            type="date"
            name="crearCierreFecha"
            [(ngModel)]="crearCierreFecha"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Caja inicial</span>
          <input
            type="number"
            name="crearCierreCajaInicial"
            [(ngModel)]="crearCierreCajaInicial"
            min="0"
            step="0.01"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Efectivo contado</span>
          <input
            type="number"
            name="crearCierreEfectivoContado"
            [(ngModel)]="crearCierreEfectivoContado"
            min="0"
            step="0.01"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Observaciones (opcional)</span>
          <textarea
            name="crearCierreObservaciones"
            [(ngModel)]="crearCierreObservaciones"
            rows="3"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm resize-none"></textarea>
        </label>

        <button
          type="submit"
          class="mt-1 px-3 py-1.5 rounded-md bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium"
          [disabled]="guardandoCierre">
          {{ guardandoCierre ? 'Guardando...' : 'Crear cierre' }}
        </button>
      </form>
    </section>

    <!-- 4. RESUMEN INGRESOS VS GASTOS -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 flex flex-col gap-4">
      <h2 class="text-lg font-semibold text-gray-800">
        Resumen ingresos vs gastos
      </h2>
      <p class="text-xs text-gray-500">
        Compara los ingresos registrados en caja con los gastos del período.
      </p>

      <form (ngSubmit)="calcularResumenIngresosGastos()" class="grid grid-cols-1 gap-3 text-sm">
        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Desde</span>
          <input
            type="date"
            name="resumenDesde"
            [(ngModel)]="resumenDesde"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Hasta</span>
          <input
            type="date"
            name="resumenHasta"
            [(ngModel)]="resumenHasta"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Total de gastos</span>
          <input
            type="number"
            name="resumenGastos"
            [(ngModel)]="resumenGastos"
            min="0"
            step="0.01"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <button
          type="submit"
          class="mt-1 px-3 py-1.5 rounded-md bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium"
          [disabled]="cargandoResumen">
          {{ cargandoResumen ? 'Calculando...' : 'Calcular resumen' }}
        </button>
      </form>

      <div *ngIf="resumenIngresosGastos" class="mt-3 text-sm space-y-1">
        <p><strong>Desde:</strong> {{ resumenIngresosGastos.desde }}</p>
        <p><strong>Hasta:</strong> {{ resumenIngresosGastos.hasta }}</p>
        <p><strong>Total ingresos:</strong> L. {{ resumenIngresosGastos.totalIngresos | number:'1.2-2' }}</p>
        <p><strong>Total gastos:</strong> L. {{ resumenIngresosGastos.totalGastos | number:'1.2-2' }}</p>
        <p><strong>Resultado:</strong> L. {{ resumenIngresosGastos.resultado | number:'1.2-2' }}</p>
        <p>
          <strong>Estado:</strong>
          <span
            [ngClass]="resumenIngresosGastos.estaEnNegativo ? 'text-red-600 font-semibold' : 'text-green-600 font-semibold'">
            {{ resumenIngresosGastos.estaEnNegativo ? 'En negativo' : 'En positivo' }}
          </span>
        </p>
      </div>
    </section>

    <!-- 5. BALANCE GENERAL -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 flex flex-col gap-4">
      <h2 class="text-lg font-semibold text-gray-800">
        Balance general
      </h2>
      <p class="text-xs text-gray-500">
        Activo, pasivo y patrimonio neto a una fecha de corte.
      </p>

      <form (ngSubmit)="cargarBalanceGeneral()" class="flex items-end gap-3 text-sm">
        <label class="flex flex-col gap-1">
          <span class="text-xs text-gray-600">Fecha de corte</span>
          <input
            type="date"
            name="fechaBalance"
            [(ngModel)]="fechaBalance"
            class="border border-gray-300 rounded-md px-3 py-2 text-sm"
            required />
        </label>

        <button
          type="submit"
          class="px-3 py-1.5 rounded-md bg-slate-800 hover:bg-slate-900 text-white text-xs font-medium"
          [disabled]="cargandoBalance">
          {{ cargandoBalance ? 'Calculando...' : 'Calcular balance' }}
        </button>
      </form>

      <div *ngIf="balanceGeneral" class="mt-3 text-sm space-y-1">
        <p><strong>Fecha de corte:</strong> {{ balanceGeneral.fechaCorte }}</p>

        <h3 class="mt-2 font-semibold text-gray-700">Activo</h3>
        <p>Activo total: L. {{ balanceGeneral.activo | number:'1.2-2' }}</p>

        <h3 class="mt-2 font-semibold text-gray-700">Pasivo</h3>
        <p>Pasivo total: L. {{ balanceGeneral.pasivo | number:'1.2-2' }}</p>

        <h3 class="mt-2 font-semibold text-gray-700">Patrimonio neto</h3>
        <p>Patrimonio neto: L. {{ balanceGeneral.patrimonioNeto | number:'1.2-2' }}</p>

        <div class="mt-2 border-t border-gray-200 pt-2">
          <p><strong>Total Activos:</strong> L. {{ balanceGeneral.totalActivos | number:'1.2-2' }}</p>
          <p><strong>Total Pasivo + Patrimonio:</strong> L. {{ balanceGeneral.totalPasivoPatrimonio | number:'1.2-2' }}</p>
          <p>
            <strong>Estado:</strong>
            <span
              [ngClass]="balanceGeneral.cuadra ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'">
              {{ balanceGeneral.cuadra ? 'Sí cuadra (A = P + PN)' : 'No cuadra' }}
            </span>
          </p>
        </div>
      </div>
    </section>

  </div>
</div>
